<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±è¥¿ç”ºãƒ©ã‚¤ãƒ•ãƒ»ã‚¢ãƒ—ãƒª</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 0; padding-bottom: 80px; }
        .container { padding: 15px; display: none; }
        .active { display: block; }
        .box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 15px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-blue { background: #007aff; color: white; }
        .btn-green { background: #34c759; color: white; }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; margin-bottom: 15px; background: #000; }
        
        /* äºˆå®šã‚«ãƒ†ã‚´ãƒªã®ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .radio-group { display: flex; gap: 10px; margin: 10px 0; }
        .radio-label { flex: 1; text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; background: #f9f9f9; }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + .radio-label { background: #e0f0ff; border-color: #007aff; color: #007aff; font-weight: bold; }

        /* ä¸‹éƒ¨ãƒŠãƒ“ */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #ddd; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-item { text-align: center; color: #888; font-size: 12px; cursor: pointer; width: 50%; }
        .nav-item.active-tab { color: #007aff; font-weight: bold; }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="tab-shopping" class="container active">
        <div class="box">
            <h3>ğŸ›’ åº•å€¤ãƒã‚§ãƒƒã‚¯ï¼†ç™»éŒ²</h3>
            <div id="reader"></div>
            <button class="btn-blue" onclick="startScan()">ğŸ“· ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹</button>
            <hr>
            <input type="text" id="item" placeholder="å“åï¼ˆè‡ªå‹•å…¥åŠ›ï¼‰">
            <input type="number" id="price" placeholder="ä¾¡æ ¼ï¼ˆç¨è¾¼ï¼‰" inputmode="numeric">
            <input type="number" id="weight" placeholder="å†…å®¹é‡ï¼ˆg ã¾ãŸã¯ å€‹ï¼‰" inputmode="numeric">
            <input type="text" id="store" placeholder="åº—åï¼ˆãƒ•ã‚¸ã€ãƒãƒ«ãƒŠã‚«ãªã©ï¼‰">
            <div id="unit-result" style="margin-top:10px; text-align:center;">100gå˜ä¾¡ï¼š--- å††</div>
            <button class="btn-green" onclick="submitPrice()">åº•å€¤ãƒªã‚¹ãƒˆã¸ç™»éŒ²</button>
        </div>
    </div>

    <div id="tab-schedule" class="container">
        <div class="box">
            <h3>ğŸ“… äºˆå®šã‚’è¿½åŠ </h3>
            
            <label>ã‚¤ãƒ™ãƒ³ãƒˆå</label>
            <input type="text" id="event-name" placeholder="ä¾‹ï¼šæ¸©æ³‰æ—…è¡Œã€è¨˜å¿µæ—¥">
            
            <label>æ—¥ä»˜</label>
            <input type="date" id="event-date">
            
            <label>èª°ã®äºˆå®šï¼Ÿ</label>
            <div class="radio-group">
                <input type="radio" name="owner" id="naoki" value="naoki">
                <label for="naoki" class="radio-label">ğŸ”µå°šè¼</label>
                
                <input type="radio" name="owner" id="maki" value="maki">
                <label for="maki" class="radio-label">ğŸ”´çœŸè¼</label>
                
                <input type="radio" name="owner" id="common" value="common" checked>
                <label for="common" class="radio-label">ğŸŸ¢2äºº</label>
            </div>
            
            <button class="btn-green" onclick="submitEvent()">äºˆå®šã‚’ç™»éŒ²ã™ã‚‹</button>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active-tab" onclick="switchTab('shopping')">
            <span class="nav-icon">ğŸ›’</span>è²·ã„ç‰©
        </div>
        <div class="nav-item" onclick="switchTab('schedule')">
            <span class="nav-icon">ğŸ“…</span>äºˆå®š
        </div>
    </div>

    <script>
        // â˜…GASã®URLã‚’ã“ã“ã«è²¼ã‚‹
        const GAS_URL = "ã‚ãªãŸã®GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURL";

        function switchTab(tabName) {
            document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active-tab'));
            document.getElementById('tab-' + tabName).classList.add('active');
            event.currentTarget.classList.add('active-tab');
        }

        // --- è²·ã„ç‰©æ©Ÿèƒ½ ---
        const scanner = new Html5Qrcode("reader");
        function startScan() { scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (text) => { scanner.stop(); fetchItem(text); }); }
        async function fetchItem(jan) {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ type: "web_app", action: "search_jan", jan: jan }) });
            const data = await res.json(); document.getElementById('item').value = data.itemName || "æœªç™»éŒ²å•†å“";
        }
        function calculateUnit() {
            const p = document.getElementById('price').value, w = document.getElementById('weight').value;
            if(p && w) document.getElementById('unit-result').innerText = `100gå˜ä¾¡ï¼š${Math.round((p/w)*100)} å††`;
        }
        document.getElementById('price').addEventListener('input', calculateUnit);
        document.getElementById('weight').addEventListener('input', calculateUnit);
        async function submitPrice() {
            const payload = {
                type: "web_app", action: "register_price", item: document.getElementById('item').value,
                price: document.getElementById('price').value, weight: document.getElementById('weight').value,
                store: document.getElementById('store').value
            };
            await fetch(GAS_URL, { method: "POST", body: JSON.stringify(payload) }); alert("åº•å€¤ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼");
        }

        // --- äºˆå®šç™»éŒ²æ©Ÿèƒ½ ---
        async function submitEvent() {
            const name = document.getElementById('event-name').value;
            const date = document.getElementById('event-date').value;
            const owner = document.querySelector('input[name="owner"]:checked').value;
            
            if(!name || !date) return alert("ã‚¤ãƒ™ãƒ³ãƒˆåã¨æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            
            const payload = { type: "web_app", action: "register_event", name: name, date: date, owner: owner };
            
            if(confirm(`ã€${name}ã€‘\n${date}\nã‚«ãƒ†ã‚´ãƒªï¼š${document.querySelector('input[name="owner"]:checked').nextElementSibling.innerText}\n\nç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ`)) {
                await fetch(GAS_URL, { method: "POST", body: JSON.stringify(payload) });
                alert("ç™»éŒ²å®Œäº†ï¼");
                document.getElementById('event-name').value = "";
                document.getElementById('event-date').value = "";
            }
        }
    </script>
</body>
</html>
