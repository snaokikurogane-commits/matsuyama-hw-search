<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>求人を自動検索中... | 松山市ハローワーク案内</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f4f7f8; }
        .loader-container { text-align: center; }
        .loader { border: 8px solid #f3f3f3; border-top: 8px solid #005bac; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        p { color: #005bac; font-weight: bold; }
    </style>
</head>
<body>

    <div class="loader-container">
        <div class="loader"></div>
        <p id="status-text">エリアの求人を検索しています...</p>
    </div>

    <form id="hw-form" method="POST" action="https://www.hellowork.mhlw.go.jp/kensaku/GECA110010.do">
        <input type="hidden" name="formName" value="GECA110010Form">
        <input type="hidden" name="action" value="search"> <input type="hidden" name="screenId" value="GECA110010"> <input type="hidden" name="tikuCd" value="38201"> <input type="hidden" name="freeWordKbn" value="2"> <input type="hidden" id="hw-freeword" name="freeWord" value="">
    </form>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        // 地名を少し絞り、全角スペースで繋ぐ形式に戻しました（これが一番安定します）
        const areaData = {
            "east": "一番町 二番町 大街道 湊町 道後 石手 持田",
            "west": "大手町 南江戸 竹原 小栗 土居田 宮西 萱町 山越 衣山",
            "north": "潮見 久枝 和気 堀江 吉藤 谷町 久万ノ台 問屋町",
            "south": "石井 居相 古川 はなみずき 和泉 今在家 北土居 天山 森松",
            "joto": "小野 久米 平井 鷹子 来住 湯の山 梅本",
            "josai": "三津浜 高浜 味生 生石 垣生 余土 空港通 斎院 保免",
            "hojo": "北条 浅海 立岩 難波 正岡 河野 粟井",
            "island": "泊 由良 睦野 中島 津和地 怒和"
        };

        const urlParams = new URLSearchParams(window.location.search);
        const areaKey = urlParams.get('area') || 'east';

        liff.init({ liffId: "2008861133-K7MEPuXN" }).then(() => {
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                // 検索キーワードをセットして送信
                document.getElementById('hw-freeword').value = areaData[areaKey];
                
                // 1秒だけ待ってから送信（ハローワーク側の準備時間を稼ぐ）
                setTimeout(() => {
                    document.getElementById('hw-form').submit();
                }, 1000);
            }
        }).catch((err) => {
            document.getElementById('status-text').innerText = "エラーが発生しました。再度お試しください。";
        });
    </script>
</body>
</html>
